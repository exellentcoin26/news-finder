// database
datasource db {
    provider = "postgresql"
    url      = "postgres://ppdb_admin:admin@localhost:5432/ppdb"
}

// generator
generator client {
    provider             = "prisma-client-py"
    interface            = "asyncio"
    recursive_type_depth = -1
}

// data models
model Users {
    id         Int           @id @default(autoincrement())
    username   String        @unique
    created_at DateTime      @default(now())
    admin      Boolean       @default(false)
    login      UserLogins?
    cookies    UserCookies[]
}

model UserLogins {
    user     Users  @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    id       Int    @id
    password String
}

model UserCookies {
    user      Users   @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    id        Int
    cookie    String  @id
    logged_in Boolean
}

model NewsSources {
    id       Int            @id @default(autoincrement())
    name     String         @unique
    url      String         @unique
    rss      RssEntries[]
    articles NewsArticles[]
}

model RssEntries {
    source NewsSources @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    id     Int
    feed   String

    @@id([id, feed])
}

model NewsArticles {
    id               Int                 @id @default(autoincrement())
    source           NewsSources         @relation(fields: [source_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    source_id        Int
    url              String
    title            String
    description      String
    photo            Bytes
    publication_date DateTime
    labels           NewsArticleLabels[]
    similar1         NewsArticles[]      @relation("similar")
    similar2         NewsArticles[]      @relation("similar")
}

model Labels {
    name     String              @id
    articles NewsArticleLabels[]
}

model NewsArticleLabels {
    article      NewsArticles @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    id           Int
    label_object Labels       @relation(fields: [label], references: [name], onDelete: Cascade, onUpdate: Cascade)
    label        String

    @@id([id, label])
}
